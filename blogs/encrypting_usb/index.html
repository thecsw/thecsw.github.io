<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Sagindyk Urazayev">
<link rel="canonical" href="https://sandyuraz.com/blogs/encrypting_usb/">
<meta property="og:image" content="https://sandyuraz.com/blogs/encrypting_usb/preview.png">
<meta property="og:image:alt" content="Preview">
<meta property="og:image:type" content="image/png">
<meta property="og:image:width" content="1280">
<meta property="og:image:height" content="640">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="icon" href="/favicon.ico">
<meta property="og:site_name" content="Sandy&apos;s Website">
<meta property="og:url" content="https://sandyuraz.com/blogs/encrypting_usb/">
<meta property="og:locale" content="en_GB">
<meta property="og:type" content="website">
<meta name="theme-color" content="#fffff4">
<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:site" content="Sandy&apos;s Website">
<meta property="twitter:creator" content="@sandyuraz">
<meta property="twitter:image:src" content="https://sandyuraz.com/blogs/encrypting_usb/preview.png">
<meta property="twitter:url" content="https://sandyuraz.com/blogs/encrypting_usb/">
<script type="module">document.documentElement.classList.remove("no-js");document.documentElement.classList.add("js");</script>
<script async src="/scripts/time.js"></script>
<meta property="og:title" content="Encrypting your drive with LUKS üóù">
<meta property="twitter:title" content="Encrypting your drive with LUKS üóù">
<meta property="description" content="Sometimes you want to store some information securily and on a tight...">
<meta property="og:description" content="Sometimes you want to store some information securily and on a tight...">
<meta property="twitter:description" content="Sometimes you want to store some information securily and on a tight...">
<title>Encrypting your drive with LUKS üóù</title>
</head>
<link rel="stylesheet" type="text/css" href="https://sandyuraz.com/css/asciidoctor.css">
<link rel="stylesheet" type="text/css" href="https://sandyuraz.com/css/web.css">
<body class="article">
<div id="header">
<h1><img id="myface" src="/small.png" width="100">Encrypting your drive with LUKS üóù</h1>
<div class="details">
<span id="author" class="author">Sagindyk Urazayev</span><br>
<span id="email" class="email">ctu ku edu</span><br>
<span id="revdate"><a href="/about">About ü§î</a> | <a href="/books">Bookshelf üìñ</a> | <a href="/fortunes">Fortunes ü•†</a> | <a href="/">Home üè†</a></span>
</div>
<div id="hetime" class="details"></div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>April 11th, 2020</p>
</div>
<div class="quoteblock abstract">
<div class="title">Abstract</div>
<blockquote>
The Linux Unified Key Setup (LUKS) is a disk encryption specification
created by Clemens Fruhwirth in 2004 and was originally intended for
Linux. - Wikipedia
</blockquote>
</div>
<div class="paragraph">
<p>Sometimes you want to store some information securily and on a tight
leash. It may be your tax return or some high school love letters you
used to write. Where would you put it? Upload it somewhere and hope no
one gets it? Not exactly, the moment you upload it to some server, uncle
Bob or Sam have your piece of data on their machines. Surely, you can
encrypt every file and move it that way, fair enough. Can get a bit
cumbersome really quick.</p>
</div>
<div class="paragraph">
<p>Best way to keep your data safe is on a piece of paper with some ink
splattered on it. That&#8217;s not very feasible for our needs. This is a
quick and dirty cheatsheet on how to use LUKS to full encrypt your flash
drive and keep it close to your heart. This is the same thing Ubunt does
when you tell it to encrypt your disk.</p>
</div>
<div class="paragraph">
<p>This is not an exhaustive guide or a full walkthrough of what LUKS is
and how it works. Just something to get youstarted. Possible cloud
solutions at the end</p>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Adventures ‚õµ</div>
<ul class="sectlevel2">
<li><a href="#_preparation">Preparation</a></li>
<li><a href="#_setting_it_up">Setting it up</a></li>
<li><a href="#_mounting_the_drive">Mounting the drive</a></li>
<li><a href="#_closeluks">closeLUKS</a></li>
<li><a href="#_closing_thoughts">Closing thoughts</a></li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_preparation">Preparation</h3>
<div class="paragraph">
<p>Backup all your data on your thumb drive, because we will need to erase
everything from it and rewrite the filesystem tables.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>%</code> symbolizes the shell prompt.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_setting_it_up">Setting it up</h3>
<div class="paragraph">
<p>Let <code>/dev/sdb</code> be your USB drive. Be careful, we don&#8217;t want to
accidentally wipe everything out on your hard drive. Follow the
instructions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">% cryptsetup --verbose --verify-passphrase luksFormat /dev/sdb</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s open the drive with LUKS and write a filesystem to it. Enter
your new passphrase and name where to map it, <code>sdb</code> is just an example.
It maps to <code>/dev/mapper/sdb</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">% cryptsetup open /dev/sdb sdb</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we got access to the drive, let&#8217;s write your favorite filesystem,
I&#8217;ll go with <code>ext4</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">% mkfs.ext4 /dev/mapper/sdb</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mounting_the_drive">Mounting the drive</h3>
<div class="paragraph">
<p>Let&#8217;s write something to the drive. <code>/mnt/flash</code> is some mounting target</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">% mount /dev/mapper/sdb /mnt/flash</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it, you have access now</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">% cd /mnt/flash
% touch man
% echo cat &gt; fish</code></pre>
</div>
</div>
<div class="paragraph">
<p>After we&#8217;re done, do the usual thing by unmounting it</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">% umount /mnt/flash</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_closeluks">closeLUKS</h3>
<div class="paragraph">
<p>Don&#8217;t forget we have to close the LUKS drive and dump the encryption
details</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">% cryptsetup close sdb</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_closing_thoughts">Closing thoughts</h3>
<div class="paragraph">
<p>Voil√†! You now have fully encrypted and secure drive. Next time, just
don&#8217;t forget the sequence of cryptopen, mount, ???, unmount, and
cryptclose. If you are looking for trusty cloud solutions, try out
<a href="https://keybase.io/">Keybase</a>. It&#8217;s a great e2e service for all your
needs
<b style="color:#ba3925">‚óºÔ∏é</b></p>
</div>
</div>
</div>
</body>
</html>